{"ast":null,"code":"import _regeneratorRuntime from\"/home/fazna/cleanit/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/fazna/cleanit/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fazna/cleanit/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{IonHeader,IonDatetime,IonToolbar,IonTitle,IonContent,IonPage,IonButtons,IonMenuButton,IonRow,IonCol,IonButton,IonList,IonItem,IonLabel,IonText,IonSelect,IonSelectOption}from'@ionic/react';import'./Login.scss';import{setIsLoggedIn,setUsername}from'../data/user/user.actions';import{connect}from'../data/connect';import{Plugins,CameraResultType,CameraSource}from'@capacitor/core';import firebase from'firebase/app';import'firebase/firestore';import{getUserData}from'../data/dataApi';import{Modal}from'./Modal';import{useLocation}from\"react-router-dom\";var Camera=Plugins.Camera,Dialog=Plugins.Dialog,Toast=Plugins.Toast;var BookSlot=function BookSlot(_ref){var setIsLoggedIn=_ref.setIsLoggedIn,history=_ref.history,setUsernameAction=_ref.setUsername;var sampleimageurl='https://img-getpocket.cdn.mozilla.net/296x148/filters:format(jpeg):quality(60):no_upscale():strip_exif()/https%3A%2F%2Fpocket-image-cache.com%2F1200x%2Ffilters%3Ano_upscale()%3Aformat(jpg)%3Aextract_cover()%2Fhttps%253A%252F%252Fpocket-syndicated-images.s3.amazonaws.com%252Farticles%252F5204%252F1595959480_GettyImages-129164329.jpgcrop.jpg22.jpg';var _useState=useState(''),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),time=_useState4[0],setTime=_useState4[1];var _useState5=useState('2021-06-15'),_useState6=_slicedToArray(_useState5,2),date=_useState6[0],setDate=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),coord=_useState8[0],setCoord=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),location=_useState10[0],setLocation=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),image=_useState12[0],setImage=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),gpsEnable=_useState14[0],setGpsEnabled=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),formSubmitted=_useState16[0],setFormSubmitted=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),usernameError=_useState18[0],setUsernameError=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),passwordError=_useState20[0],setPasswordError=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),loading=_useState22[0],setLoading=_useState22[1];var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),phone=_useState24[0],setPhone=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),showModal=_useState26[0],setShowModal=_useState26[1];useEffect(function(){function getData(){return _getData.apply(this,arguments);}function _getData(){_getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getUserData();case 2:res=_context.sent;setPhone(res.username);console.log(res);case 5:case\"end\":return _context.stop();}}},_callee);}));return _getData.apply(this,arguments);}getData();},[getUserData]);useEffect(function(){},[]);var search=useLocation().search;var query=new URLSearchParams(search).get(\"query\");function alert(){return _alert.apply(this,arguments);}function _alert(){_alert=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return Dialog.alert({title:'Successfully Updated',message:\"You have selected \".concat(time,\" on \").concat(date)});case 3:_context6.next=10;break;case 5:_context6.prev=5;_context6.t0=_context6[\"catch\"](0);console.log(_context6.t0);_context6.next=10;return Toast.show({text:\"You have selected \".concat(time,\" on \").concat(date)});case 10:case\"end\":return _context6.stop();}}},_callee6,null,[[0,5]]);}));return _alert.apply(this,arguments);}var timeslots=['10-12pm','2pm-4pm','6pm-7pm'];useEffect(function(){console.log(date);alert();},[date]);var login=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var db,data,docRef;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setLoading(true);e.preventDefault();//ADD DATA TO DB\ndb=firebase.firestore();data={date:'12-10-19',image:image,time:time,category:query};try{docRef=db.collection('waste_collection_details').doc(phone);docRef.get().then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(doc){var doc_data,bookings,res,_res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!doc.exists){_context2.next=9;break;}doc_data=doc.data();bookings=doc_data.bookings;bookings.push(data);_context2.next=6;return db.collection('waste_collection_details').doc(phone).update({bookings:bookings});case 6:res=_context2.sent;_context2.next=12;break;case 9:_context2.next=11;return db.collection('waste_collection_details').doc(phone).set({bookings:[data]});case 11:_res=_context2.sent;case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}());setLoading(false);// alert()\nsetShowModal(true);}catch(e){console.log(e);}case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function login(_x){return _ref2.apply(this,arguments);};}();var getPicture=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var res;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:res=addImage(CameraSource.Photos);case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function getPicture(){return _ref4.apply(this,arguments);};}();var addImage=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(source){var images;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return Camera.getPhoto({quality:60,allowEditing:true,resultType:CameraResultType.DataUrl,source:source});case 3:images=_context5.sent;if(images){setImage(images);}_context5.next=10;break;case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);console.log(_context5.t0);case 10:case\"end\":return _context5.stop();}}},_callee5,null,[[0,7]]);}));return function addImage(_x3){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(IonPage,{id:\"details-page\"},/*#__PURE__*/React.createElement(IonHeader,null,/*#__PURE__*/React.createElement(IonToolbar,null,/*#__PURE__*/React.createElement(IonButtons,{slot:\"start\"},/*#__PURE__*/React.createElement(IonMenuButton,null)),/*#__PURE__*/React.createElement(IonTitle,null,\"Book Your Slot\"))),/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(\"form\",{noValidate:true,onSubmit:login},/*#__PURE__*/React.createElement(IonList,null,/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\",color:\"primary\"},\"Select Date\"),/*#__PURE__*/React.createElement(IonDatetime,{min:'2021-06-15',max:'2025-01-01',value:date,onIonChange:function onIonChange(e){return setDate(e.detail.value);}})),formSubmitted&&usernameError&&/*#__PURE__*/React.createElement(IonText,{color:\"danger\"},/*#__PURE__*/React.createElement(\"p\",{className:\"ion-padding-start\"},\"Date is required\")),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\",color:\"primary\"},\"Time\"),/*#__PURE__*/React.createElement(IonSelect,{value:time,placeholder:\"Select One\",onIonChange:function onIonChange(e){return setTime(e.detail.value);}},timeslots.map(function(i){return/*#__PURE__*/React.createElement(IonSelectOption,{value:i},i);}))),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\",color:\"primary\"},\"Picture\"),/*#__PURE__*/React.createElement(IonButton,{style:{borderRadius:0},color:\"primary\",onClick:function onClick(){getPicture();}},\"Upload Picture\")),image!==null&&/*#__PURE__*/React.createElement(\"div\",{style:{margin:'20px'}},/*#__PURE__*/React.createElement(\"img\",{style:{marginTop:'10px'},src:image.dataUrl}))),/*#__PURE__*/React.createElement(IonRow,null,/*#__PURE__*/React.createElement(IonCol,null,/*#__PURE__*/React.createElement(IonButton,{disabled:loading,type:\"submit\",expand:\"block\",onClick:function onClick(e){return login(e);}},\"Submit\"))),/*#__PURE__*/React.createElement(Modal,{openModal:showModal,text:\"You have selected \".concat(time,\" on \").concat(date),closeModal:function closeModal(){return history.push('/dashboard',{direction:'none'});}}))));};export default connect({mapDispatchToProps:{setIsLoggedIn:setIsLoggedIn,setUsername:setUsername,getUserData:getUserData},component:BookSlot});","map":{"version":3,"sources":["/home/fazna/cleanit/src/pages/BookSlot.tsx"],"names":["React","useEffect","useState","IonHeader","IonDatetime","IonToolbar","IonTitle","IonContent","IonPage","IonButtons","IonMenuButton","IonRow","IonCol","IonButton","IonList","IonItem","IonLabel","IonText","IonSelect","IonSelectOption","setIsLoggedIn","setUsername","connect","Plugins","CameraResultType","CameraSource","firebase","getUserData","Modal","useLocation","Camera","Dialog","Toast","BookSlot","history","setUsernameAction","sampleimageurl","username","time","setTime","date","setDate","coord","setCoord","location","setLocation","image","setImage","gpsEnable","setGpsEnabled","formSubmitted","setFormSubmitted","usernameError","setUsernameError","passwordError","setPasswordError","loading","setLoading","phone","setPhone","showModal","setShowModal","getData","res","console","log","search","query","URLSearchParams","get","alert","title","message","show","text","timeslots","login","e","preventDefault","db","firestore","data","category","docRef","collection","doc","then","exists","doc_data","bookings","push","update","set","getPicture","addImage","Photos","source","getPhoto","quality","allowEditing","resultType","DataUrl","images","detail","value","map","i","borderRadius","margin","marginTop","dataUrl","direction","mapDispatchToProps","component"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { IonHeader,IonDatetime, IonToolbar, IonTitle, IonContent, IonPage, IonButtons, IonMenuButton, IonRow, IonCol, IonButton, IonList, IonItem, IonLabel, IonInput, IonText, IonTextarea, IonToggle, IonSelect, IonItemOption, IonSelectOption, IonIcon } from '@ionic/react';\nimport './Login.scss';\nimport { setIsLoggedIn, setUsername } from '../data/user/user.actions';\nimport { connect } from '../data/connect';\nimport { RouteComponentProps } from 'react-router';\nimport { Plugins, CameraResultType, CameraSource ,CameraPhoto} from '@capacitor/core';\nimport firebase from 'firebase/app'\nimport 'firebase/firestore';\nimport { getUserData } from '../data/dataApi';\nimport { Modal } from './Modal';\nimport {useLocation} from \"react-router-dom\";\n\nconst { Camera ,Dialog,Toast} = Plugins;\ninterface OwnProps extends RouteComponentProps {}\n\ninterface DispatchProps {\n  setIsLoggedIn: typeof setIsLoggedIn;\n  setUsername: typeof setUsername;\n  getUserData: typeof getUserData;\n}\n// const db = firebase.firestore()\ninterface LoginProps extends OwnProps,  DispatchProps { }\ninterface PhotoData extends CameraPhoto {}\nconst BookSlot: React.FC<LoginProps> = ({setIsLoggedIn, history, setUsername: setUsernameAction}) => {\n  const  sampleimageurl = 'https://img-getpocket.cdn.mozilla.net/296x148/filters:format(jpeg):quality(60):no_upscale():strip_exif()/https%3A%2F%2Fpocket-image-cache.com%2F1200x%2Ffilters%3Ano_upscale()%3Aformat(jpg)%3Aextract_cover()%2Fhttps%253A%252F%252Fpocket-syndicated-images.s3.amazonaws.com%252Farticles%252F5204%252F1595959480_GettyImages-129164329.jpgcrop.jpg22.jpg'\n  const [username, setUsername] = useState('');\n  const [time, setTime] = useState('');\n  const [date,setDate] = useState('2021-06-15');\n  const [coord,setCoord] = useState('');\n  const [location,setLocation] = useState('');\n  const [image,setImage] = useState<PhotoData | null>(null)\n  const [gpsEnable,setGpsEnabled] = useState(false)\n  const [formSubmitted, setFormSubmitted] = useState(false);\n  const [usernameError, setUsernameError] = useState(false);\n  const [passwordError, setPasswordError] = useState(false);\n  const [loading,setLoading] = useState(false)\n  const [phone,setPhone] = useState('')\n  const [showModal,setShowModal] = useState(false)\n \n  useEffect(()=>{\n    async function getData() {\n      let res = await getUserData()\n      setPhone(res.username)\n      console.log(res)\n     }\n    getData()\n  },[getUserData])\n\n  useEffect(()=>{\n\n  },[])\n  const search = useLocation().search;    \n  const query = new URLSearchParams(search).get(\"query\");\n  async function alert(){\n   try{\n    await Dialog.alert({\n      title: 'Successfully Updated',\n      message: `You have selected ${time} on ${date}`,\n    });\n   }catch(e){\n     console.log(e)\n     await Toast.show({\n      text: `You have selected ${time} on ${date}`\n     })\n   }\n  }\n\nconst timeslots = ['10-12pm','2pm-4pm','6pm-7pm']\nuseEffect(()=>{\n  console.log(date)\n  alert()\n},[date])\n  const login = async (e: React.FormEvent) => {\n    setLoading(true)\n    e.preventDefault();\n\n    //ADD DATA TO DB\n\n    const db = firebase.firestore()\n    const data = {\n      date:'12-10-19',\n      image:image,\n      time:time,\n      category:query\n    }\n    try {\n      var docRef = db.collection('waste_collection_details').doc(phone)\n\n      docRef.get().then(async(doc) => {\n          if(doc.exists) {\n            let doc_data = doc.data()\n            let bookings = doc_data.bookings\n            bookings.push(data)\n            \n            let res = await db.collection('waste_collection_details').doc(phone).update({bookings})\n\n          }else{\n            let res = await db.collection('waste_collection_details').doc(phone).set({bookings:[data]})\n\n          }\n        })\n\n      setLoading(false)// alert()\n      setShowModal(true)\n      \n    }catch(e) {\n      console.log(e)\n    }\n    \n    \n    \n  };\n  const getPicture = async() => {\n      const res = addImage(CameraSource.Photos)\n  }\n  const addImage  = async(source: CameraSource) => {\n    try{\n      const images = await Camera.getPhoto({\n        quality: 60,\n        allowEditing: true,\n        resultType: CameraResultType.DataUrl,\n        source\n      });\n      if(images){\n        setImage(images)\n      }\n    }\n    catch(err){\n      console.log(err)\n    }\n \n    \n\n  }\n  \n \n  \n  return (\n    <IonPage id=\"details-page\">\n      <IonHeader>\n        <IonToolbar>\n          <IonButtons slot=\"start\">\n            <IonMenuButton></IonMenuButton>\n          </IonButtons>\n          <IonTitle>Book Your Slot</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n\n        <form noValidate onSubmit={login}>\n          <IonList>\n            <IonItem>\n              <IonLabel position=\"stacked\" color=\"primary\">Select Date</IonLabel>\n              <IonDatetime min={'2021-06-15'} max={'2025-01-01'} value={date} onIonChange={e => setDate(e.detail.value!)}/>\n              \n            </IonItem>\n\n            {formSubmitted && usernameError && <IonText color=\"danger\">\n              <p className=\"ion-padding-start\">\n                Date is required\n              </p>\n            </IonText>}\n\n            \n            <IonItem>\n              <IonLabel position=\"stacked\" color=\"primary\">Time</IonLabel>\n              <IonSelect value={time} placeholder=\"Select One\" onIonChange={e => setTime(e.detail.value)}>\n                \n                {timeslots.map(i => \n                <IonSelectOption value={i}>{i}</IonSelectOption>\n                    )}\n              </IonSelect>\n            </IonItem>\n           \n            \n            <IonItem>\n              <IonLabel position=\"stacked\" color=\"primary\">Picture</IonLabel>\n              <IonButton style={{borderRadius:0}} color=\"primary\" onClick={()=>{getPicture()}}>\n                {/* <IonIcon name=\"camera\"/> */}\n                Upload Picture</IonButton>\n            </IonItem>\n            {image!==null && \n            <div style={{margin:'20px'}}>\n              <img style={{marginTop:'10px'}} src={image.dataUrl}/></div>}\n              \n          </IonList>\n\n          <IonRow>\n            <IonCol>\n              <IonButton disabled={loading} type=\"submit\" expand=\"block\" onClick={(e)=>login(e)}>Submit</IonButton>\n            </IonCol>\n            {/* <IonCol>\n              <IonButton routerLink=\"/signup\" color=\"light\" expand=\"block\">Signup</IonButton>\n            </IonCol> */}\n          </IonRow>\n          <Modal openModal={showModal} text={`You have selected ${time} on ${date}`} closeModal={()=>history.push('/dashboard', {direction: 'none'})}/>\n\n        </form>\n\n      </IonContent>\n\n    </IonPage>\n  );\n};\n\nexport default connect<OwnProps, {}, DispatchProps>({\n  mapDispatchToProps: {\n    setIsLoggedIn,\n    setUsername,\n    getUserData\n  },\n  component: BookSlot\n})"]},"metadata":{},"sourceType":"module"}