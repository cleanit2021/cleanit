{"ast":null,"code":"import _regeneratorRuntime from\"/home/fazna/cleanit/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/fazna/cleanit/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/fazna/cleanit/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{IonHeader,IonToolbar,IonTitle,IonContent,IonPage,IonButtons,IonMenuButton,IonRow,IonCol,IonButton,IonList,IonItem,IonLabel,IonInput,IonText,IonTextarea,IonToggle}from'@ionic/react';import'./Login.scss';import{setIsLoggedIn,setUsername}from'../data/user/user.actions';import{connect}from'../data/connect';import firebase from'firebase/app';import'firebase/firestore';import{getUserData}from'../data/dataApi';import{Plugins}from'@capacitor/core';import{Modal}from'./Modal';var Geolocation=Plugins.Geolocation;var Login=function Login(_ref){var setIsLoggedIn=_ref.setIsLoggedIn,history=_ref.history,setUsername=_ref.setUsername;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUserName=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),pincode=_useState4[0],setPincode=_useState4[1];var _useState5=useState({latitude:0,longitude:0}),_useState6=_slicedToArray(_useState5,2),coord=_useState6[0],setCoord=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isEdited=_useState8[0],setIsEdited=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),location=_useState10[0],setLocation=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),gpsEnable=_useState12[0],setGpsEnabled=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),formSubmitted=_useState14[0],setFormSubmitted=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),usernameError=_useState16[0],setUsernameError=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),phone=_useState18[0],setPhone=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),loading=_useState20[0],setLoading=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),showModal=_useState22[0],setShowModal=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),showlocModal=_useState24[0],setShowLocModal=_useState24[1];var _useState25=useState('1'),_useState26=_slicedToArray(_useState25,2),reset=_useState26[0],setReset=_useState26[1];var db=firebase.firestore();useEffect(function(){function getData(){return _getData.apply(this,arguments);}function _getData(){_getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,docRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getUserData();case 2:res=_context.sent;setStateofPhoneNumber(res.username);console.log(res);if(res.username!==''){docRef=db.collection(\"user_data\").doc(res.username);docRef.get().then(function(doc){if(doc.exists){console.log('DOC EXISTS',doc.data().pincode,parseInt(doc.data().pincode));setUserName(doc.data().name);setStateofPincode(doc.data().pincode);setCoord(doc.data().coord);setLocation(doc.data().location);setIsEdited(true);}});}case 6:case\"end\":return _context.stop();}}},_callee);}));return _getData.apply(this,arguments);}getData();console.log(\"Hello getuserdata\",phone);},[getUserData]);var setStateofPhoneNumber=function setStateofPhoneNumber(phonenum){setPhone(phonenum);};var setStateofPincode=function setStateofPincode(data){setPincode(data);};var login=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var data,docRef;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();setLoading(true);setFormSubmitted(true);if(!username){setUsernameError(true);}data={name:username,coord:coord,location:location,pincode:pincode};docRef=db.collection(\"user_data\").doc(phone);docRef.get().then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(doc){var res,_res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!doc.exists){_context2.next=8;break;}console.log(\"Doc exists\",phone);_context2.next=4;return db.collection('user_data').doc(phone).update(data);case 4:res=_context2.sent;setShowModal(true);_context2.next=12;break;case 8:_context2.next=10;return db.collection('user_data').doc(phone).set(data);case 10:_res=_context2.sent;setShowModal(true);case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}()).catch(function(error){console.log(\"Error getting document:\",error);});// history.push('/dashboard', {direction: 'none'});\ncase 7:case\"end\":return _context3.stop();}}},_callee3);}));return function login(_x){return _ref2.apply(this,arguments);};}();var getLocation=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var c,bool;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:Geolocation.getCurrentPosition().then(function(coordinates){// lat= coordinates.coords.latitude || 0\n// long = coordinates.coords.longitude || 0\nc={latitude:coordinates.coords.latitude,longitude:coordinates.coords.longitude};setCoord(c);setShowLocModal(true);console.log('Current position:',coordinates.coords.latitude,coord,showModal);bool=true;}).catch(function(e){console.log(e);});// console.log('Current position:',coordinates.coords.latitude,coord);\n// api.get('http://api.positionstack.com/v1/forward?access_key=bce98239614aaa6f7954015a64f6bb76')\ncase 1:case\"end\":return _context4.stop();}}},_callee4);}));return function getLocation(){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(IonPage,{id:\"details-page\"},/*#__PURE__*/React.createElement(IonHeader,null,/*#__PURE__*/React.createElement(IonToolbar,null,/*#__PURE__*/React.createElement(IonButtons,{slot:\"start\"},/*#__PURE__*/React.createElement(IonMenuButton,null)),/*#__PURE__*/React.createElement(IonTitle,null,\"Details\"))),/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(\"form\",{noValidate:true,onSubmit:login},/*#__PURE__*/React.createElement(IonList,{className:\"div-with-space\"},/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\",color:\"primary\"},\"Name\"),/*#__PURE__*/React.createElement(IonInput,{name:\"username\",type:\"text\",value:username,spellCheck:false,autocapitalize:\"off\",onIonChange:function onIonChange(e){return setUserName(e.detail.value);},required:true})),formSubmitted&&usernameError&&/*#__PURE__*/React.createElement(IonText,{color:\"danger\"},/*#__PURE__*/React.createElement(\"p\",{className:\"ion-padding-start\"},\"Name is required\")),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\",color:\"primary\"},\"Pincode\"),/*#__PURE__*/React.createElement(IonInput,{name:\"age\",value:pincode,placeholder:pincode,onIonChange:function onIonChange(e){return setPincode(e.detail.value);},required:true})),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\",color:\"primary\"},\"Use GPS\"),/*#__PURE__*/React.createElement(IonToggle,{checked:gpsEnable,onIonChange:function onIonChange(e){return setGpsEnabled(e.detail.checked);}})),!gpsEnable&&/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\",color:\"primary\"},\"Location\"),/*#__PURE__*/React.createElement(IonTextarea,{name:\"text\",value:location,spellCheck:false,autocapitalize:\"off\",onIonChange:function onIonChange(e){return setLocation(e.detail.value);},required:true})),gpsEnable&&/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\",color:\"primary\"},\"Location\"),/*#__PURE__*/React.createElement(IonButton,{color:\"primary\",onClick:function onClick(){getLocation();}},\"Use Current Location\"))),/*#__PURE__*/React.createElement(IonRow,null,/*#__PURE__*/React.createElement(IonCol,null,/*#__PURE__*/React.createElement(IonButton,{disabled:loading,type:\"submit\",expand:\"block\",onClick:function onClick(e){return login(e);}},isEdited?'Update':'Submit')))),/*#__PURE__*/React.createElement(Modal,{openModal:showlocModal,text:'Successfully selected Data',closeModal:function closeModal(){setShowLocModal(false);}}),/*#__PURE__*/React.createElement(Modal,{openModal:showModal,text:'Hi '+username+\", We have successfully \".concat(isEdited?'updated':'saved',\" Your Details\"),closeModal:function closeModal(){return history.push('/dashboard',{direction:'none'});}})));};export default connect({mapDispatchToProps:{setIsLoggedIn:setIsLoggedIn,setUsername:setUsername,getUserData:getUserData},component:Login});","map":{"version":3,"sources":["/home/fazna/cleanit/src/pages/DetailsPage.tsx"],"names":["React","useEffect","useState","IonHeader","IonToolbar","IonTitle","IonContent","IonPage","IonButtons","IonMenuButton","IonRow","IonCol","IonButton","IonList","IonItem","IonLabel","IonInput","IonText","IonTextarea","IonToggle","setIsLoggedIn","setUsername","connect","firebase","getUserData","Plugins","Modal","Geolocation","Login","history","username","setUserName","pincode","setPincode","latitude","longitude","coord","setCoord","isEdited","setIsEdited","location","setLocation","gpsEnable","setGpsEnabled","formSubmitted","setFormSubmitted","usernameError","setUsernameError","phone","setPhone","loading","setLoading","showModal","setShowModal","showlocModal","setShowLocModal","reset","setReset","db","firestore","getData","res","setStateofPhoneNumber","console","log","docRef","collection","doc","get","then","exists","data","parseInt","name","setStateofPincode","phonenum","login","e","preventDefault","update","set","catch","error","getLocation","getCurrentPosition","coordinates","c","coords","bool","detail","value","checked","push","direction","mapDispatchToProps","component"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { IonHeader, IonToolbar, IonTitle, IonContent, IonPage, IonButtons, IonMenuButton, IonRow, IonCol, IonButton, IonList, IonItem, IonLabel, IonInput, IonText, IonTextarea, IonToggle, IonModal } from '@ionic/react';\nimport './Login.scss';\nimport { setIsLoggedIn, setUsername } from '../data/user/user.actions';\nimport { connect } from '../data/connect';\nimport { RouteComponentProps } from 'react-router';\nimport firebase from 'firebase/app'\nimport 'firebase/firestore';\nimport { getUserData } from '../data/dataApi';\nimport {  Plugins } from '@capacitor/core'\nimport MapView from './MapView';\nimport Map from '../components/Map';\nimport { Modal } from './Modal';\n\nconst { Geolocation } = Plugins\ninterface OwnProps extends RouteComponentProps {}\n\ninterface DispatchProps {\n  setIsLoggedIn: typeof setIsLoggedIn;\n  setUsername: typeof setUsername;\n  getUserData: typeof getUserData;\n}\n\ninterface LoginProps extends OwnProps,  DispatchProps { }\n\nconst Login: React.FC<LoginProps> = ({setIsLoggedIn, history, setUsername}) => {\n\n  const [username, setUserName] = useState('');\n  const [pincode,setPincode] = useState('');\n  const [coord,setCoord] = useState({\n    latitude:0,\n    longitude:0\n  });\n  const [isEdited,setIsEdited] =  useState(false)\n  const [location,setLocation] = useState('');\n  const [gpsEnable,setGpsEnabled] = useState(false);\n  const [formSubmitted, setFormSubmitted] = useState(false);\n  const [usernameError, setUsernameError] = useState(false);\n  const [phone,setPhone] = useState('');\n  const [loading,setLoading] = useState(false);\n  const [showModal,setShowModal] = useState(false);\n  const [showlocModal,setShowLocModal] = useState(false);\n\n  const [reset,setReset] = useState('1')\n  const db = firebase.firestore()\n  useEffect(()=>{\n    async function getData() {\n      let res = await getUserData()\n      setStateofPhoneNumber(res.username)\n      console.log(res)\n      if(res.username!==''){\n        var docRef = db.collection(\"user_data\").doc(res.username);\n\n        docRef.get().then((doc) => {\n            if(doc.exists) {\n              console.log('DOC EXISTS',doc.data().pincode,parseInt(doc.data().pincode))  \n              setUserName(doc.data().name)   \n              setStateofPincode(doc.data().pincode)\n              setCoord(doc.data().coord)\n              setLocation(doc.data().location) \n              setIsEdited(true)     \n            }})\n      }  \n    }\n    getData()\n    console.log(\"Hello getuserdata\", phone)\n  },[getUserData])\n\n  const setStateofPhoneNumber = (phonenum:any) => {\n    setPhone(phonenum)\n  }\n  const setStateofPincode = (data:any) => {\n    setPincode(data)\n    \n  }\n  const login = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true)\n    setFormSubmitted(true);\n    if(!username) {\n      setUsernameError(true);\n    }\n    \n    const data = {\n      name : username,\n      coord,\n      location,\n      pincode\n    }\n\n    var docRef = db.collection(\"user_data\").doc(phone);\n    docRef.get().then(async(doc) => {\n        if(doc.exists) {\n          console.log(\"Doc exists\",phone);\n          let res = await db.collection('user_data').doc(phone).update(data)\n          setShowModal(true)\n        } else {\n            // doc.data() will be undefined in this case\n            let res = await db.collection('user_data').doc(phone).set(data)\n            setShowModal(true)\n        }\n    }).catch((error) => {\n        console.log(\"Error getting document:\", error);\n    });\n    // history.push('/dashboard', {direction: 'none'});\n\n  };\n  const getLocation = async() => {\n    var c;\n    var bool;\n    Geolocation.getCurrentPosition().then(\n      (coordinates) => {\n        // lat= coordinates.coords.latitude || 0\n        // long = coordinates.coords.longitude || 0\n       c = {\n          latitude: coordinates.coords.latitude,longitude:coordinates.coords.longitude\n        }\n        setCoord(c)\n    setShowLocModal(true)\n      console.log('Current position:',coordinates.coords.latitude,coord,showModal);\n      bool = true\n      }\n      \n    ).catch(e => {\n      console.log(e)\n    });\n   \n  // console.log('Current position:',coordinates.coords.latitude,coord);\n    // api.get('http://api.positionstack.com/v1/forward?access_key=bce98239614aaa6f7954015a64f6bb76')\n  }\n  return (\n    <IonPage id=\"details-page\">\n      <IonHeader>\n        <IonToolbar>\n          <IonButtons slot=\"start\">\n            <IonMenuButton></IonMenuButton>\n          </IonButtons>\n          <IonTitle>Details</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n\n        <form noValidate onSubmit={login}>\n          <IonList className=\"div-with-space\">\n            <IonItem>\n              <IonLabel position=\"stacked\" color=\"primary\">Name</IonLabel>\n              <IonInput name=\"username\" type=\"text\" value={username} spellCheck={false} autocapitalize=\"off\" onIonChange={e => setUserName(e.detail.value!)}\n                required>\n              </IonInput>\n            </IonItem>\n\n            {formSubmitted && usernameError && <IonText color=\"danger\">\n              <p className=\"ion-padding-start\">\n                Name is required\n              </p>\n            </IonText>}\n\n            <IonItem>\n              <IonLabel position=\"stacked\" color=\"primary\">Pincode</IonLabel>\n              <IonInput name=\"age\" value={pincode} placeholder={pincode} onIonChange={e => setPincode(e.detail.value!)}\n                required>\n              </IonInput>\n            </IonItem>\n\n            <IonItem>\n              <IonLabel position=\"stacked\" color=\"primary\">Use GPS</IonLabel>\n              <IonToggle checked={gpsEnable} onIonChange={e => setGpsEnabled(e.detail.checked)} />\n            \n            </IonItem>\n            { !gpsEnable && \n            <IonItem>\n              <IonLabel position=\"stacked\" color=\"primary\">Location</IonLabel>\n              <IonTextarea name=\"text\" value={location} spellCheck={false} autocapitalize=\"off\" onIonChange={e => setLocation(e.detail.value!)}\n                required>\n              </IonTextarea>\n            </IonItem>}\n            { gpsEnable && \n            <IonItem>\n              <IonLabel position=\"stacked\" color=\"primary\">Location</IonLabel>\n              <IonButton color=\"primary\" onClick={()=>{getLocation()}}>Use Current Location</IonButton>\n              \n            </IonItem>}\n\n{/* <IonButton onClick={()=>\n  {\n    console.log(pincode,parseInt(\"678547\"))}\n  }>Phone</IonButton> */}\n          </IonList>\n              \n          <IonRow>\n            <IonCol>\n              <IonButton disabled={loading} type=\"submit\" expand=\"block\" onClick={(e)=>login(e)}>{isEdited ? 'Update' : 'Submit'}</IonButton>\n            </IonCol>\n            {/* <IonCol>\n              <IonButton routerLink=\"/signup\" color=\"light\" expand=\"block\">Signup</IonButton>\n            </IonCol> */}\n          </IonRow>\n        </form>\n        <Modal openModal={showlocModal} text={'Successfully selected Data'} closeModal={()=>{setShowLocModal(false)}}/>\n           \n\n        <Modal openModal={showModal} text={'Hi '+username+`, We have successfully ${isEdited ? 'updated' : 'saved'} Your Details`} closeModal={()=>history.push('/dashboard', {direction: 'none'})}/>\n        \n      </IonContent>\n     \n    </IonPage>\n  );\n};\n\nexport default connect<OwnProps, {}, DispatchProps>({\n  mapDispatchToProps: {\n    setIsLoggedIn,\n    setUsername,\n    getUserData\n  },\n  component: Login\n})"]},"metadata":{},"sourceType":"module"}